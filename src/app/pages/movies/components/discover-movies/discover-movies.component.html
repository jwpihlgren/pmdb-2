<aside>
    <form (ngSubmit)="onSubmit()" [formGroup]="discoverForm">
        <fieldset class="filter">
            <legend>Genre</legend>
            <app-combobox [title]="'Choose'" [multiSelect]="true" formControlName="genres">
                @for(g of genres; track $index) {
                <app-combobox-item class="list-item" [value]="g.id.toString()">{{g.name}}</app-combobox-item>
                }
            </app-combobox>
            <app-chip-list class="selected">
                @for(g of discoverForm.value.genres; track $index) {
                @let chip = getGenre(g);
                <app-chip [value]="chip!.id.toString()" [action]="true"
                    (clickRequest)="onGenreRemove(chip!.id)">{{chip!.name}}</app-chip>
                }
            </app-chip-list>

        </fieldset>
        <fieldset class="filter" formGroupName="voteAverage">
            <legend>Vote average</legend>
            <div class="filter--range">
                <label>
                    At least
                    <app-combobox [title]="voteAverage.getRawValue().gte?.name || ''" [multiSelect]="false"
                        formControlName="gte">
                        @for(i of voteAverageOptions.list; track $index) {
                        <app-combobox-item class="list-item" [value]="i.value.toString()">{{i.name}}</app-combobox-item>
                        }
                    </app-combobox>
                </label>
                <label>
                    At most
                    <app-combobox [title]="voteAverage.getRawValue().lte?.name || ''" [multiSelect]="false"
                        formControlName="lte">
                        @for(i of voteAverageOptions.list; track $index) {
                        <app-combobox-item class="list-item" [value]="i.value.toString()">{{i.name}}</app-combobox-item>
                        }
                    </app-combobox>
                </label>

            </div>
        </fieldset>
        <fieldset class="filter" formGroupName="releaseDate">
            <legend>Release date</legend>
            <div class="filter--range">
                <label>
                    At least
                    <app-combobox [title]="releaseDate.getRawValue().gte?.name || ''" formControlName="gte">
                        @for(i of yearOptions.list; track $index) {
                        <app-combobox-item class="list-item" [value]="i.value.toString()">{{i.name}}</app-combobox-item>
                        }
                    </app-combobox>
                </label>
                <label>
                    At most
                    <app-combobox [title]="releaseDate.getRawValue().lte?.name || ''" formControlName="lte">
                        @for(i of yearOptions.list; track $index) {
                        <app-combobox-item class="list-item" [value]="i.value.toString()">{{i.name}}</app-combobox-item>
                        }
                    </app-combobox>
                </label>
            </div>
        </fieldset>

        <fieldset class="filter" formGroupName="include">
            <legend>Include</legend>
            <div class="extra">
                <app-expandable-multi-select>
                    <app-select-item formControlName="adult">Adult</app-select-item>
                    <app-select-item formControlName="video">Video</app-select-item>
                </app-expandable-multi-select>
            </div>
        </fieldset>
        <fieldset class="filter">
            <legend>Keywords</legend>
            <div class="keywords">
                <app-text-input #trigger [formControl]="keywordForm.controls.keyword"></app-text-input>
                @if(keywordSearchResult().length > 0) {
                <app-dropdown-list [triggerElement]="trigger.elementRef">
                    @for(result of keywordSearchResult(); track $index) {
                    <li (click)="onKeywordSelect(result.value)" class="list-item">{{result.name}}</li>
                    }
                </app-dropdown-list>
                }
            </div>
            <app-chip-list class="selected">
                @for(keyword of withKeywords.controls["keywords"].getRawValue(); track $index) {
                @let keywordName = lookupKeyword(keyword);
                <app-chip [value]="keyword" [action]="true"
                    (clickRequest)="onKeywordRemove($index)">{{keywordName}}</app-chip>
                }
            </app-chip-list>

        </fieldset>
        <button class="button button--primary">Discover</button>
    </form>
</aside>

<main>
    @defer(when results() !== undefined) {
    <app-simple-grid [maxWidth]="cardMaxWidth">
        @for( movie of results(); track $index) {
        <app-card [params]="createCardParams(movie)">
            <app-content-movie [params]="movie"></app-content-movie>
        </app-card>
        }
    </app-simple-grid>
    <app-pagination (pageRequest)=handlePageRequest($event) [pagination]="pagination()"></app-pagination>
    }
    @loading() {
    <app-simple-grid [maxWidth]="cardMaxWidth">
        @for(card of [].constructor(20); track $index){
        <app-card-loading></app-card-loading>
        }
    </app-simple-grid>
    }

    @placeholder {
    <app-simple-grid [maxWidth]="cardMaxWidth">
        @for(card of [].constructor(20); track $index){
        <app-card-loading></app-card-loading>
        }
    </app-simple-grid>
    }
</main>
