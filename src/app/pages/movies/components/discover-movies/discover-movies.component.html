<form (ngSubmit)="onSubmit()" [formGroup]="discoverForm">
    <fieldset>
        <legend>Genre</legend>
        <app-combobox [title]="'choose'">
            <app-listbox class="list" [params]="listboxParams" formControlName="genres"></app-listbox>
            <app-chip-list class="selected">
                @for(chip of discoverForm.value.genres; track $index) {
                <app-chip [value]="chip.toString()" (action)="onRemove($event)">{{parseGenre(chip)}}</app-chip>
                }
            </app-chip-list>
        </app-combobox>
    </fieldset>

    <fieldset formGroupName="voteAverage">
        <legend>Vote average</legend>
        <label for="vote-average-gte">
            At least
            <app-combobox [title]="discoverForm.value.voteAverage!.lte ? discoverForm.value.voteAverage!.lte[0] : ''">
                <app-listbox class="list" id="vote-average-gte" formControlName="gte"
                    [params]="voteAverageOptions"></app-listbox>
            </app-combobox>
        </label>
        <label for="vote-average-lte">
            At most
            <app-combobox [title]="'test'">
                <app-listbox class="list" id="vote-average-lte" formControlName="lte"
                    [params]="voteAverageOptions"></app-listbox>
            </app-combobox>
        </label>
    </fieldset>
    <fieldset formGroupName="releaseDate">
        <legend>Release date</legend>
        <label for="release-date-gte">
            At least
            <select id="release-date-gte" formControlName="gte">
                <optgroup>
                    <option [value]=""></option>
                    @for(year of generateNumberRange(2025, 1900); track $index) {
                    <option [value]="year">{{year}}</option>
                    }
                </optgroup>
            </select>
        </label>
        <label for="release-date-lte">
            At most
            <select id="release-date-lte" formControlName="lte">
                <optgroup>
                    <option [value]=""></option>
                    @for(year of generateNumberRange(2025, 1900); track $index) {
                    <option [value]="year">{{year}}</option>
                    }
                </optgroup>
            </select>

        </label>
    </fieldset>

    <fieldset formGroupName="include">
        <legend>Include</legend>
        <label for="include-adult">
            Adult
            <input id="include-adult" type="checkbox" formControlName="adult">
        </label>
        <label for="include-video">
            Video
            <input id="include-video" type="checkbox" formControlName="video">
        </label>
    </fieldset>
    <button>Discover</button>
</form>

@defer(on immediate; when results() !== undefined) {
<app-card-grid>
    @for( movie of results(); track $index) {
    <app-card [params]="{id: movie.id, src: movie.posterImagePath}">
        <app-content-movie [params]="movie"></app-content-movie>
    </app-card>
    }
</app-card-grid>
}
