<aside>
    <form (ngSubmit)="onSubmit()" [formGroup]="discoverForm">
        <fieldset class="filter" formGroupName="withGenres">
            <legend>Genre</legend>
            <app-combobox [title]="'Choose'" [multiSelect]="true" formControlName="values">
                @for(g of genres; track $index) {
                <app-combobox-item class="list-item" [value]="g.id.toString()">{{g.name}}</app-combobox-item>
                }
            </app-combobox>
            <app-chip-list class="selected">
                @for(g of discoverForm.controls.withGenres.controls.values.getRawValue(); track $index) {
                @let chip = getGenre(g);
                <app-chip [value]="chip!.id.toString()" [action]="true"
                    (clickRequest)="onGenreRemove(chip!.id)">{{chip!.name}}</app-chip>
                }
            </app-chip-list>

        </fieldset>
        <fieldset class="filter">
            <legend>Vote average</legend>
            <div class="filter--range">
                <label>
                    At least
                    <app-combobox [title]="discoverForm.controls.voteAverageGte.getRawValue() ?? '---'"
                        [multiSelect]="false" formControlName="voteAverageGte">
                        @for(i of voteAverageOptions.list; track $index) {
                        <app-combobox-item class="list-item" [value]="i.value.toString()">{{i.name}}</app-combobox-item>
                        }
                    </app-combobox>
                </label>
                <label>
                    At most
                    <app-combobox [title]="discoverForm.controls.voteAverageLte.getRawValue() ?? '---'"
                        [multiSelect]="false" formControlName="voteAverageLte">
                        @for(i of voteAverageOptions.list; track $index) {
                        <app-combobox-item class="list-item" [value]="i.value.toString()">{{i.name}}</app-combobox-item>
                        }
                    </app-combobox>
                </label>

            </div>
        </fieldset>
        <fieldset class="filter">
            <legend>Release date</legend>
            <div class="filter--range">
                <label>
                    At least
                    <app-combobox [title]="discoverForm.controls.firstAirDateGte.getRawValue() ?? '---'"
                        formControlName="firstAirDateGte">
                        @for(i of yearOptions.list; track $index) {
                        <app-combobox-item class="list-item" [value]="i.value.toString()">{{i.name}}</app-combobox-item>
                        }
                    </app-combobox>
                </label>
                <label>
                    At most
                    <app-combobox [title]="discoverForm.controls.firstAirDateLte.getRawValue() ?? '---'"
                        formControlName="firstAirDateLte">
                        @for(i of yearOptions.list; track $index) {
                        <app-combobox-item class="list-item" [value]="i.value.toString()">{{i.name}}</app-combobox-item>
                        }
                    </app-combobox>
                </label>
            </div>
        </fieldset>

        <fieldset class="filter">
            <legend>Include</legend>
            <div class="extra">
                <app-expandable-multi-select>
                    <app-select-item formControlName="includeAdult">Adult</app-select-item>
                    <app-select-item formControlName="includeVideo">Video</app-select-item>
                </app-expandable-multi-select>
            </div>
        </fieldset>
        <fieldset class="filter">
            <legend>Keywords</legend>
            <div class="keywords">
                <app-text-input #trigger [formControl]="keywordForm.controls.keyword"></app-text-input>
                @if(keywordSearchResult().length > 0) {
                <app-dropdown-list [triggerElement]="trigger.elementRef">
                    @for(result of keywordSearchResult(); track $index) {
                    <li (click)="onKeywordSelect(result.value)" class="list-item">{{result.name}}</li>
                    }
                </app-dropdown-list>
                }
            </div>
            <app-chip-list class="selected">
                @for(keyword of discoverForm.controls.withKeywords.controls.values.getRawValue(); track $index) {
                @let keywordName = lookupKeyword(keyword);
                <app-chip [value]="keyword" [action]="true"
                    (clickRequest)="onKeywordRemove($index)">{{keywordName}}</app-chip>
                }
            </app-chip-list>

        </fieldset>
        <button class="button button--primary">Discover</button>
    </form>
</aside>

<main>
    @defer(when results() !== undefined) {
    <app-simple-grid [maxWidth]="cardMaxWidth">
        @for( show of results()!.result!; track $index) {
        <app-card [params]="createCardParams(show)">
            <app-content-show [params]="show"></app-content-show>
        </app-card>
        }
    </app-simple-grid>
    <app-pagination (pageRequest)=onUpdateAndSubmit($event) [pagination]="results()!.pagination"></app-pagination>

    }
    @loading() {
    <app-simple-grid [maxWidth]="cardMaxWidth">
        @for(card of [].constructor(20); track $index){
        <app-card-loading></app-card-loading>
        }
    </app-simple-grid>
    }

    @placeholder {
    <app-simple-grid [maxWidth]="cardMaxWidth">
        @for(card of [].constructor(20); track $index){
        <app-card-loading></app-card-loading>
        }
    </app-simple-grid>

    }
</main>
